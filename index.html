
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Reduce referrer leakage to external sites -->
    <meta name="referrer" content="no-referrer">
    <!-- Strengthen CSP by upgrading insecure requests and allowing workers safely -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://www.google.com https://www.gstatic.com 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https: http://localhost:10000 http://127.0.0.1:10000 http://0.0.0.0:10000 https://www.google.com https://www.gstatic.com https://dns.google; worker-src 'self' blob:; object-src 'none'; base-uri 'self'; upgrade-insecure-requests">
    <title>EventCall - Where Every Event Matters</title>
    <!-- Explicit favicon to avoid default /favicon.ico on organization root -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%231a1f2e'/%3E%3Ccircle cx='32' cy='32' r='20' fill='%23d4af37'/%3E%3C/svg%3E">
    <!-- UX-002 stylesheet for BEM classes and variables -->
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="styles/main.min.css">
    <link rel="stylesheet" href="styles/components.css?v=20260226b">
    <link rel="stylesheet" href="styles/invite.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <link rel="stylesheet" href="styles/accessibility.css">
    <link rel="stylesheet" href="styles/login.css">
    <link rel="stylesheet" href="styles/dashboard-v2.css">
    <link rel="stylesheet" href="styles/event-management-v2.css">
    <link rel="stylesheet" href="styles/seating-chart.css">
    <link rel="stylesheet" href="styles/loading.css">
    <link rel="stylesheet" href="styles/app-loader.css">
    <!-- Form Validation Styles -->
    <link rel="stylesheet" href="styles/form-validation.css">
    <!-- Feedback Widget -->
    <link rel="stylesheet" href="styles/feedback.css">
    <!-- Admin Dashboard (Admin Only) -->
    <link rel="stylesheet" href="styles/admin-dashboard.css">
    <link rel="stylesheet" href="styles/redesign.css">
    <!-- Profile Completion Modal -->
    <link rel="stylesheet" href="styles/profile-completion.css">
    <!-- Envelope Invitation Template -->
    <link rel="stylesheet" href="styles/invite-envelope.css">
    <link rel="stylesheet" href="styles/side-by-side.css">
    <!-- Google Fonts for Envelope Template -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- SVG Icon System (load before other scripts) -->
    <script src="js/icons.js"></script>

    <!-- Local Auth Config for Testing -->
    <script src="js/auth-config.js?v=20260225"></script>

    <!-- PHASE 3 OPTIMIZATION: Resource hints for CDN libraries -->
    <!-- Preconnect to CDN to reduce DNS/TCP/TLS overhead -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://www.google.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>

    <!-- Scripts -->
    <!-- CSV Parser -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <!-- DOMPurify for HTML sanitization -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js" crossorigin="anonymous"></script>
    <!-- PHASE 3: zxcvbn moved to lazy loading (250KB saved on initial load) -->

</head>
<body>
<!-- App Loading Screen (hidden by default, shows only after login) -->
<div id="app-loader" class="app-loader hidden">
    <div class="app-loader__container">
        <div class="app-loader__header">
            <div class="app-loader__icon"><svg class="ec-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="8" r="7" stroke="currentColor" stroke-width="2" fill="none"/><path d="M8.21 13.89L7 23l5-3 5 3-1.21-9.12" stroke="currentColor" stroke-width="2" fill="none"/></svg></div>
            <h1 class="app-loader__title">EventCall</h1>
            <p class="app-loader__subtitle">Semper Admin</p>
        </div>

        <!-- Book Loader -->
        <div class="book-loader" aria-hidden="true">
            <div class="book-loader__shadow"></div>
            <div class="book-loader__page"></div>
            <div class="book-loader__page book-loader__page--2"></div>
            <div class="book-loader__page book-loader__page--3"></div>
            <div class="book-loader__page book-loader__page--4"></div>
            <div class="book-loader__page book-loader__page--5"></div>
        </div>

        <!-- Status Text -->
        <div class="app-loader__status">
            <p class="app-loader__status-label">Loading</p>
            <div class="app-loader__words" aria-hidden="true">
                <span class="app-loader__word">events</span>
                <span class="app-loader__word">responses</span>
                <span class="app-loader__word">dashboard</span>
                <span class="app-loader__word">security</span>
                <span class="app-loader__word">events</span>
            </div>
            </div>
        </div>
    </div>
</div>

<!-- Removed skip-to-main anchor per request -->
<!-- Updated Login Page HTML with Obfuscated Token -->

<!-- ============================================
     USERNAME/PASSWORD LOGIN PAGE
     ============================================ -->
<div id="login-page">
    <div class="login-container-v2">
        <div class="login-branding-v2">
            <div class="login-branding-v2__content">
                <svg class="branding-logo-v2" width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" fill="#FFF" fill-opacity="0.1"/>
                    <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 3.5V6.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 3.5V6.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4 9.5H20" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <rect x="8" y="12" width="2" height="2" rx="0.5" fill="white"/>
                    <rect x="14" y="12" width="2" height="2" rx="0.5" fill="white"/>
                    <rect x="8" y="15" width="2" height="2" rx="0.5" fill="white"/>
                </svg>
                <h1 class="login-branding-v2__title">EventCall</h1>
                <p class="login-branding-v2__subtitle">Mission-Ready Event Management</p>
            </div>
        </div>
        <div class="login-form-container-v2">
            <div class="auth auth__card">
                <div class="auth__header">
                     </div>


        <!-- Tab Switcher -->
        <div class="auth__tabs">
            <button type="button" class="auth__tab auth__tab--active" data-tab="login" onclick="switchAuthTab('login')">
                Sign In
            </button>
            <button type="button" class="auth__tab" data-tab="register" onclick="switchAuthTab('register')">
                Create Account
            </button>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="auth__form auth__form--active">
            <div class="form-group">
                <label for="login-username" class="form-label">
                    Username
                </label>
                <input
                    type="text"
                    id="login-username"
                    name="username"
                    placeholder="Enter your username"
                    required
                    autocomplete="username"
                    class="form-control"
                >
            </div>

            <div class="form-group">
                <label for="login-password" class="form-label">
                    Password
                </label>
                <input
                    type="password"
                    id="login-password"
                    name="password"
                    placeholder="Enter your password"
                    required
                    autocomplete="current-password"
                    class="form-control"
                >
            </div>

            <div class="auth__remember">
                <input type="checkbox" id="remember-me" class="auth__remember-checkbox">
                <label for="remember-me" class="auth__remember-label">
                    Remember me for 7 days
                </label>
            </div>

            <button type="submit" class="btn btn--primary">
                <svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/><path d="M7 11V7a5 5 0 0110 0v4" stroke="currentColor" stroke-width="2" fill="none"/></svg> Sign In
            </button>

            <div class="auth__link-container">
                <button type="button" class="btn-link" id="show-forgot-password-btn">
                    Forgot your password?
                </button>
            </div>

            <!-- Bypass button added for development -->
            <div class="auth__link-container" style="margin-top: 1rem;">
                <button type="button" id="bypass-login-btn" class="btn btn--secondary" style="display:none; width: 100%; background-color: #5C4E4E; color: #D1D0D0;"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 00-2.91-.09zM12 15l-3-3a22 22 0 012-3.95A12.88 12.88 0 0122 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 01-4 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Bypass Login (Test User)</button>
            </div>
        </form>

        <!-- Forgot Password Form -->
        <form id="forgot-password-form" class="auth__form" style="display: none;">
            <div class="auth__form-header">
                <h3><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" stroke="currentColor" stroke-width="2" fill="none"/></svg> Reset Password</h3>
                <p>Enter your username and email to verify your identity</p>
            </div>

            <div class="form-group">
                <label for="reset-username" class="form-label">Username</label>
                <input
                    type="text"
                    id="reset-username"
                    name="username"
                    placeholder="Enter your username"
                    required
                    autocomplete="username"
                    class="form-control"
                >
            </div>

            <div class="form-group">
                <label for="reset-email" class="form-label">Email Address</label>
                <input
                    type="email"
                    id="reset-email"
                    name="email"
                    placeholder="Enter your registered email"
                    required
                    autocomplete="email"
                    class="form-control"
                >
            </div>

            <button type="submit" class="btn btn--primary btn--full">
                Verify Identity
            </button>

            <div class="auth__link-container">
                <button type="button" class="btn-link" id="show-login-btn">
                    Back to Sign In
                </button>
            </div>
        </form>

        <!-- Reset Password Confirmation Form (shown after clicking reset link) -->
        <form id="reset-confirm-form" class="auth__form" style="display: none;">
            <div class="auth__form-header">
                <h3><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/><path d="M7 11V7a5 5 0 0110 0v4" stroke="currentColor" stroke-width="2" fill="none"/></svg> Set New Password</h3>
                <p>Enter your new password below</p>
            </div>

            <input type="hidden" id="reset-token" name="token">

            <div class="form-group">
                <label for="new-password" class="form-label">New Password</label>
                <input
                    type="password"
                    id="new-password"
                    name="password"
                    placeholder="Enter new password"
                    required
                    minlength="8"
                    autocomplete="new-password"
                    class="form-control"
                >
                <div id="new-password-strength"></div>
            </div>

            <div class="form-group">
                <label for="confirm-new-password" class="form-label">Confirm New Password</label>
                <input
                    type="password"
                    id="confirm-new-password"
                    name="confirmPassword"
                    placeholder="Confirm new password"
                    required
                    autocomplete="new-password"
                    class="form-control"
                >
            </div>

            <button type="submit" class="btn btn--primary btn--full">
                <svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Reset Password
            </button>

            <div class="auth__link-container">
                <button type="button" class="btn-link" id="reset-back-to-login-btn">
                    Back to Sign In
                </button>
            </div>
        </form>

        <!-- Registration Form -->
        <form id="register-form" class="auth__form">
            <div class="form-group">
                <label for="reg-username" class="form-label">
                    Username <span class="text-danger">*</span>
                </label>
                <input
                    type="text"
                    id="reg-username"
                    name="username"
                    placeholder="Choose a username (3-50 characters)"
                    required
                    minlength="3"
                    maxlength="50"
                    autocomplete="username"
                    oninput="this.value = this.value.toLowerCase();"
                    class="form-control"
                >
                <small class="form-help">Letters, numbers, dots, hyphens, underscores only (auto-converted to lowercase)</small>
            </div>

            <div class="form-group">
                <label for="reg-name" class="form-label">
                    Full Name <span class="text-danger">*</span>
                </label>
                <input
                    type="text"
                    id="reg-name"
                    name="name"
                    placeholder="Enter your full name"
                    required
                    autocomplete="name"
                    class="form-control"
                >
            </div>

            <div class="form-group">
                <label for="reg-email" class="form-label">
                    Email Address <span class="text-danger">*</span>
                </label>
                <input
                    type="email"
                    id="reg-email"
                    name="email"
                    placeholder="your.email@example.com"
                    required
                    autocomplete="email"
                    class="form-control"
                >
                <small class="form-help">Used for account recovery and notifications</small>
            </div>

            <div class="form-group">
                <label for="reg-branch" class="form-label">
                    Service Branch <span class="form-help form-help--inline">(Optional)</span>
                </label>
                <select
                    id="reg-branch"
                    name="branch"
                    class="form-control"
                    onchange="window.updateRegRanksForBranch && window.updateRegRanksForBranch()"
                >
                    <option value="">Select service branch...</option>
                    <option value="USA">United States Army</option>
                    <option value="USMC">United States Marine Corps</option>
                    <option value="USN">United States Navy</option>
                    <option value="USAF">United States Air Force</option>
                    <option value="USSF">United States Space Force</option>
                    <option value="USCG">United States Coast Guard</option>
                    <option value="Civilian">Civilian</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="reg-rank" class="form-label">
                    Rank <span class="form-help form-help--inline">(Optional)</span>
                </label>
                <select
                    id="reg-rank"
                    name="rank"
                    class="form-control"
                    disabled
                >
                    <option value="">Select service branch first...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="reg-password" class="form-label">
                    Password <span class="text-danger">*</span>
                </label>
                <input
                    type="password"
                    id="reg-password"
                    name="password"
                    placeholder="Create a password (min 8 characters)"
                    required
                    minlength="8"
                    autocomplete="new-password"
                    class="form-control"
                >
                <small class="form-help">Must contain uppercase, lowercase, and number</small>
            </div>

            <div class="form-group">
                <label for="reg-confirm-password" class="form-label">
                    Confirm Password <span class="text-danger">*</span>
                </label>
                <input
                    type="password"
                    id="reg-confirm-password"
                    name="confirmPassword"
                    placeholder="Re-enter your password"
                    required
                    minlength="8"
                    autocomplete="new-password"
                    class="form-control"
                >
            </div>

            <div id="password-strength">
                <!-- Password strength indicator inserted by JS -->
            </div>

            <button type="submit" class="btn btn--primary">
                <svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 00-2.91-.09zM12 15l-3-3a22 22 0 012-3.95A12.88 12.88 0 0122 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 01-4 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Create Account
            </button>
        </form>



        <!-- Branding Footer -->
        <div class="branding-footer">
            <div class="branding-footer__powered">POWERED BY</div>
            <div class="branding-footer__brand" onclick="window.open('https://linktr.ee/semperadmin', '_blank')">
                SEMPER ADMIN
            </div>
        </div>
    </div>
        </div>
    </div>
</div>

<script>
// Tab switching functionality
function switchAuthTab(tab) {
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
const tabs = document.querySelectorAll('.auth__tab');

    tabs.forEach(btn => {
        const isActive = btn.getAttribute('data-tab') === tab;
        btn.classList.toggle('auth__tab--active', isActive);
    });

    const showLogin = tab === 'login';
    loginForm.classList.toggle('auth__form--active', showLogin);
    registerForm.classList.toggle('auth__form--active', !showLogin);

    // Reset scroll position of the form container
    const formContainer = document.querySelector('.login-form-container-v2');
    if (formContainer) {
        formContainer.scrollTop = 0;
    }
}

// Update rank dropdown based on selected service branch for registration form
function updateRegRanksForBranch() {
    const branchSelect = document.getElementById('reg-branch');
    const rankSelect = document.getElementById('reg-rank');

    if (!branchSelect || !rankSelect || !window.MilitaryData) {
        return;
    }

    const selectedBranch = branchSelect.value;

    // Clear current ranks
    rankSelect.innerHTML = '<option value="">Select rank...</option>';

    if (!selectedBranch || selectedBranch === 'Civilian' || selectedBranch === 'Other') {
        // For Civilian or Other, just add a Civilian option and disable
        if (selectedBranch === 'Civilian') {
            rankSelect.innerHTML = '<option value="Civilian">Civilian</option>';
            rankSelect.disabled = true;
        } else if (selectedBranch === 'Other') {
            rankSelect.innerHTML = '<option value="">N/A</option>';
            rankSelect.disabled = true;
        } else {
            rankSelect.innerHTML = '<option value="">Select service branch first...</option>';
            rankSelect.disabled = true;
        }
        return;
    }

    // Get ranks for selected branch
    const branchData = window.MilitaryData[selectedBranch];

    if (!branchData) {
        rankSelect.innerHTML = '<option value="">No ranks available</option>';
        rankSelect.disabled = true;
        return;
    }

    // Enable the rank dropdown
    rankSelect.disabled = false;

    // Add officer ranks
    if (branchData.officer && branchData.officer.length > 0) {
        const officerGroup = document.createElement('optgroup');
        officerGroup.label = 'Officer';
        branchData.officer.forEach(rank => {
            const option = document.createElement('option');
            option.value = rank.value;
            option.textContent = rank.label;
            officerGroup.appendChild(option);
        });
        rankSelect.appendChild(officerGroup);
    }

    // Add warrant officer ranks
    if (branchData.warrant && branchData.warrant.length > 0) {
        const warrantGroup = document.createElement('optgroup');
        warrantGroup.label = 'Warrant Officer';
        branchData.warrant.forEach(rank => {
            const option = document.createElement('option');
            option.value = rank.value;
            option.textContent = rank.label;
            warrantGroup.appendChild(option);
        });
        rankSelect.appendChild(warrantGroup);
    }

    // Add enlisted ranks
    if (branchData.enlisted && branchData.enlisted.length > 0) {
        const enlistedGroup = document.createElement('optgroup');
        enlistedGroup.label = 'Enlisted';
        branchData.enlisted.forEach(rank => {
            const option = document.createElement('option');
            option.value = rank.value;
            option.textContent = rank.label;
            enlistedGroup.appendChild(option);
        });
        rankSelect.appendChild(enlistedGroup);
    }

    // Add Civilian option at the end
    const civilianOption = document.createElement('option');
    civilianOption.value = 'Civilian';
    civilianOption.textContent = 'Civilian';
    rankSelect.appendChild(civilianOption);
}

// Make function globally available
window.updateRegRanksForBranch = updateRegRanksForBranch;

// Dashboard tab switching functionality - Version 2.0
console.log('âœ… Dashboard tab functions loaded - Version 2.0');

function switchDashboardTab(tab) {
    console.log('ðŸ”„ Switching to tab:', tab);

    const tabs = document.querySelectorAll('.dashboard-tab');
    const contents = document.querySelectorAll('.dashboard-tab-content');

    console.log('ðŸ“‹ Found', tabs.length, 'tabs and', contents.length, 'content areas');

    tabs.forEach(btn => {
        const isActive = btn.getAttribute('data-tab') === tab;
        btn.classList.toggle('dashboard-tab--active', isActive);
        console.log('  Tab', btn.getAttribute('data-tab'), ':', isActive ? 'ACTIVE' : 'inactive');
    });

    contents.forEach(content => {
        const contentId = content.id;
        const shouldShow = contentId === tab + '-tab';
        content.classList.toggle('dashboard-tab-content--active', shouldShow);
        console.log('  Content', contentId, ':', shouldShow ? 'VISIBLE' : 'hidden');
    });

    if (tab === 'active-events' || tab === 'past-events') {
        if (typeof window.renderDashboard === 'function') {
            window.renderDashboard();
        }
    }

    // Load RSVPs when switching to Your RSVPs tab
    if (tab === 'your-rsvps') {
        console.log('ðŸ“ Loading Your RSVPs...');
        if (window.displayUserRSVPs) {
            window.displayUserRSVPs();
        } else {
            console.error('âŒ displayUserRSVPs function not available');
        }
    }
}

// Make function globally available
window.switchDashboardTab = switchDashboardTab;

// Mobile navigation hamburger toggle
function toggleMobileNav() {
    const nav = document.querySelector('.main-nav');
    const overlay = document.querySelector('.nav-overlay');
    const hamburger = document.querySelector('.nav-hamburger');
    if (!nav) return;
    const isOpen = nav.classList.toggle('nav-open');
    if (overlay) overlay.classList.toggle('nav-overlay--active', isOpen);
    if (hamburger) hamburger.setAttribute('aria-expanded', isOpen);
}

function closeMobileNav() {
    const nav = document.querySelector('.main-nav');
    const overlay = document.querySelector('.nav-overlay');
    const hamburger = document.querySelector('.nav-hamburger');
    if (nav) nav.classList.remove('nav-open');
    if (overlay) overlay.classList.remove('nav-overlay--active');
    if (hamburger) hamburger.setAttribute('aria-expanded', 'false');
}

window.toggleMobileNav = toggleMobileNav;
window.closeMobileNav = closeMobileNav;

// Verify tabs exist when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', verifyDashboardTabs);
} else {
    verifyDashboardTabs();
}

function verifyDashboardTabs() {
    console.log('ðŸ” Verifying dashboard tabs setup...');
    const tabs = document.querySelectorAll('.dashboard-tab');
    const contents = document.querySelectorAll('.dashboard-tab-content');
    console.log('  Found', tabs.length, 'tab buttons');
    console.log('  Found', contents.length, 'tab content areas');

    tabs.forEach((tab, idx) => {
        console.log(`  Tab ${idx + 1}:`, tab.getAttribute('data-tab'),
                    tab.classList.contains('dashboard-tab--active') ? '[ACTIVE]' : '[inactive]');
    });

    contents.forEach((content, idx) => {
        console.log(`  Content ${idx + 1}:`, content.id,
                    content.classList.contains('dashboard-tab-content--active') ? '[VISIBLE]' : '[hidden]');
    });
}
</script>

<!-- ============================================
     MAIN APP CONTENT
     ============================================ -->
<div class="app-content hidden">
    <div class="header">
        <div class="container">
            <div class="header-content">
            <div class="header-emblem">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                    <circle cx="24" cy="24" r="22" stroke="rgba(152,134,134,0.5)" stroke-width="1.5" fill="none"/>
                    <circle cx="24" cy="24" r="16" stroke="rgba(152,134,134,0.35)" stroke-width="1" fill="none"/>
                    <path d="M24 12 L27 20 L35 20 L29 25 L31 33 L24 28 L17 33 L19 25 L13 20 L21 20 Z" fill="rgba(152,134,134,0.6)" stroke="rgba(152,134,134,0.8)" stroke-width="0.5"/>
                </svg>
            </div>
            <h1>EventCall</h1>
            <div class="tagline">WHERE EVERY EVENT MATTERS</div>
        </div>
        <div class="semper-branding">
            <div class="semper-branding__powered">POWERED BY</div>
            <div class="semper-branding__brand">SEMPER ADMIN</div>
        </div>
        </div>
    </div>

    <nav class="main-nav nav" style="display: flex;">
        <div class="container nav-container">
            <button type="button" class="nav-hamburger" aria-label="Toggle navigation" aria-expanded="false" onclick="toggleMobileNav()">
                <span class="nav-hamburger__line"></span>
                <span class="nav-hamburger__line"></span>
                <span class="nav-hamburger__line"></span>
            </button>
            <ul class="nav-links">
                <li><button type="button" class="nav-link dashboard-tab dashboard-tab--active" data-tab="active-events" onclick="switchDashboardTab('active-events'); closeMobileNav()">Active Events</button></li>
                <li><button type="button" class="nav-link dashboard-tab" data-tab="past-events" onclick="switchDashboardTab('past-events'); closeMobileNav()">Past Events</button></li>
                <li><button type="button" class="nav-link dashboard-tab" data-tab="your-rsvps" onclick="switchDashboardTab('your-rsvps'); closeMobileNav()">Your RSVPs</button></li>
                <li><button id="nav-create" class="nav-link" onclick="showPage('create'); closeMobileNav()">Create Event</button></li>
                <li><button id="nav-analytics" class="nav-link" onclick="showPage('analytics'); closeMobileNav()">Analytics</button></li>
                <li><button class="nav-link" onclick="syncWithGitHub(); closeMobileNav()">Sync RSVPs</button></li>
            </ul>
        </div>
    </nav>
    <div class="nav-overlay" onclick="closeMobileNav()"></div>

    <div class="container">
                <main id="main-content" role="main" class="power-user-view">
            <div class="power-user-view__list-panel" id="list-panel">
                <!-- Dashboard Empty State Container -->
                <div id="dashboard-empty-state-container"></div>

                <!-- Active Events Tab Content -->
                <div id="active-events-tab" class="dashboard-tab-content dashboard-tab-content--active">
                    <div id="active-events-list">
                        <div class="skeleton-grid" aria-hidden="true">
                            <div class="skeleton-card">
                                <div class="skeleton-cover"></div>
                                <div class="skeleton-body">
                                    <div class="skeleton-line skeleton-line--title"></div>
                                    <div class="skeleton-line skeleton-line--meta"></div>
                                    <div class="skeleton-line skeleton-line--meta skeleton-line--short"></div>
                                </div>
                            </div>
                            <div class="skeleton-card">
                                <div class="skeleton-cover"></div>
                                <div class="skeleton-body">
                                    <div class="skeleton-line skeleton-line--title"></div>
                                    <div class="skeleton-line skeleton-line--meta"></div>
                                    <div class="skeleton-line skeleton-line--meta skeleton-line--short"></div>
                                </div>
                            </div>
                            <div class="skeleton-card">
                                <div class="skeleton-cover"></div>
                                <div class="skeleton-body">
                                    <div class="skeleton-line skeleton-line--title"></div>
                                    <div class="skeleton-line skeleton-line--meta"></div>
                                    <div class="skeleton-line skeleton-line--meta skeleton-line--short"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Past Events Tab Content -->
                <div id="past-events-tab" class="dashboard-tab-content">
                    <div id="past-events-list">
                        <div class="skeleton-grid" aria-hidden="true">
                            <div class="skeleton-card">
                                <div class="skeleton-cover"></div>
                                <div class="skeleton-body">
                                    <div class="skeleton-line skeleton-line--title"></div>
                                    <div class="skeleton-line skeleton-line--meta"></div>
                                    <div class="skeleton-line skeleton-line--meta skeleton-line--short"></div>
                                </div>
                            </div>
                            <div class="skeleton-card">
                                <div class="skeleton-cover"></div>
                                <div class="skeleton-body">
                                    <div class="skeleton-line skeleton-line--title"></div>
                                    <div class="skeleton-line skeleton-line--meta"></div>
                                    <div class="skeleton-line skeleton-line--meta skeleton-line--short"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Your RSVPs Tab Content -->
                <div id="your-rsvps-tab" class="dashboard-tab-content">
                    <div id="user-rsvps-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading your RSVPs...
                        </div>
                    </div>
                </div>
            </div>
            <div class="power-user-view__detail-panel" id="detail-panel">
        <div id="dashboard" class="page active">

            <div id="dashboard-welcome" class="welcome-card">
                <div class="welcome-banner">
                    <div class="welcome-title">
                        <svg class="icon-medal" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="28" height="28">
                            <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.418 0-8-3.582-8-8s3.582-8 8-8 8 3.582 8 8-3.582 8-8 8zm-2-6h4v4h-4v-4zm0-6h4v4h-4V8z"/>
                        </svg>
                        Welcome to EventCall
                    </div>
                    <div class="welcome-description">
                        Professional military event management with real-time RSVP tracking. Create events instantly and share invite links for seamless coordination.
                    </div>
                    <div class="welcome-disclaimer">
                        DATA CATEGORY: SYNTHETIC / TEST DATA ONLY &rsaquo; PROTECTION LEVEL: UNSECURED POC
                    </div>
                    <div class="welcome-disclaimer">
                        Notice: This system is not authorized for the storage or processing of PII, CUI, or HIPAA regulated data. All data shown is for demonstration purposes.
                    </div>
                </div>
            </div>

            <!-- Inline Create Event Form (replaces welcome card) -->
            <div id="dashboard-create-form" class="dashboard-create-form" style="display:none;">
            </div>

        </div>

        <div id="create" class="page">
            <div class="page-header page-header--with-actions">
                <div class="page-header__left">
                    <h2 class="page-header__title">Create New Event</h2>
                </div>
                <div class="page-header__right">
                    <div class="page-header__badge"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="12" cy="12" r="2" stroke="currentColor" stroke-width="2" fill="none"/></svg> Mission Planning</div>
                </div>
            </div>

            <!-- Event Templates Selector -->
            <div id="template-selector-container"></div>

            <!-- Form Progress Indicator -->
            <div class="form-progress" id="form-progress">
                <div class="form-progress__bar">
                    <div class="form-progress__fill" id="form-progress-fill" style="width: 0%"></div>
                </div>
                <div class="form-progress__text">
                    <span class="form-progress__status" id="form-progress-status">Fill in the required fields to deploy your event</span>
                    <span class="form-progress__required">* Required fields</span>
                </div>
            </div>

            <form id="event-form">
                <!-- Basic Information Section -->
                <div class="form-section">
                    <div class="form-section__header">
                        <h3 class="form-section__title">Basic Information</h3>
                    </div>

                    <div class="form-group">
                        <label for="event-title" class="required">Event Title</label>
                        <input type="text" id="event-title" class="form-control" required placeholder="e.g., Retirement Ceremony for MSgt Johnson" aria-required="true" aria-describedby="title-help">
                        <span class="form-help-text" id="title-help">Enter a descriptive title for your event</span>
                    </div>

                    <div class="form-row form-row--two-col">
                        <div class="form-group">
                            <label for="event-date" class="required">Date</label>
                            <input type="date" id="event-date" class="form-control" required aria-required="true" aria-describedby="date-help">
                            <span class="form-help-text" id="date-help">When will your event take place?</span>
                        </div>

                        <div class="form-group">
                            <label for="event-time" class="required">Time</label>
                            <input type="time" id="event-time" class="form-control" required aria-required="true" aria-describedby="time-help">
                            <span class="form-help-text" id="time-help">What time does it start?</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="event-location">Location</label>
                        <input type="text" id="event-location" class="form-control" placeholder="e.g., Base Chapel, Building 123" aria-describedby="location-help">
                        <span class="form-help-text" id="location-help">Where will the event be held?</span>
                    </div>

                    <div class="form-group">
                        <label for="event-description">Description</label>
                        <textarea id="event-description" class="form-control" placeholder="Share the details: what's the occasion, what to expect, any special instructions..." aria-describedby="description-help" rows="4"></textarea>
                        <span class="form-help-text" id="description-help">Help guests know what to expect</span>
                    </div>

                    <div class="form-group">
                        <label for="cover-input">Cover Image <span class="label-optional">(Optional)</span></label>
                        <div class="image-upload" id="cover-upload" role="button" tabindex="0" aria-label="Upload cover image by clicking or dragging a file" aria-describedby="cover-help">
                            <p>Click or drag to upload cover image</p>
                            <input type="file" id="cover-input" accept="image/*" class="file-input" aria-label="Choose cover image file">
                        </div>
                        <span class="form-help-text" id="cover-help">Add a photo to make your event stand out (JPEG, PNG, WebP - max 5MB)</span>
                        <img id="cover-preview" class="image-preview hidden" alt="Event cover image preview">
                        <input type="hidden" id="cover-image-url" value="">
                    </div>

                    <!-- Invitation Template Selector -->
                    <div class="form-group">
                        <label>Invitation Style</label>
                        <div class="invite-template-selector" id="invite-template-selector">
                            <label class="invite-template-option">
                                <input type="radio" name="invite_template" value="classic">
                                <div class="template-preview template-preview--classic">
                                    <div class="template-preview__icon"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2" stroke="currentColor" stroke-width="2" fill="none"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1" stroke="currentColor" stroke-width="2" fill="none"/></svg></div>
                                    <div class="template-preview__name">Classic</div>
                                    <div class="template-preview__desc">Clean, simple invitation</div>
                                </div>
                            </label>
                            <label class="invite-template-option">
                                <input type="radio" name="invite_template" value="envelope" checked>
                                <div class="template-preview template-preview--envelope">
                                    <div class="template-preview__icon"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M22 10v10a2 2 0 01-2 2H4a2 2 0 01-2-2V10m20 0l-10 6L2 10m20 0l-8.97-5.7a2 2 0 00-2.06 0L2 10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                                    <div class="template-preview__name">Envelope</div>
                                    <div class="template-preview__desc">Elegant animated envelope</div>
                                </div>
                            </label>
                        </div>
                        <span class="form-help-text">Choose how your invitation will appear to guests</span>
                    </div>
                </div><!-- End Basic Information Section -->

                <!-- RSVP Settings Section -->
                <div class="form-section form-section--collapsible">
                    <div class="form-section__header">
                        <h3 class="form-section__title">RSVP Settings</h3>
                        <span class="form-section__optional">Optional</span>
                    </div>

                    <div class="rsvp-settings-options">
                        <div class="checkbox-card">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ask-reason">
                                <span>Ask guests why they're attending</span>
                            </label>
                        </div>

                        <div class="checkbox-card">
                            <label class="checkbox-label">
                                <input type="checkbox" id="allow-guests">
                                <span>Allow guests to bring additional people</span>
                            </label>
                        </div>

                        <div class="checkbox-card">
                            <label class="checkbox-label">
                                <input type="checkbox" id="requires-meal-choice">
                                <span>Event requires meal/dietary choices</span>
                            </label>
                        </div>
                    </div>
                </div><!-- End RSVP Settings Section -->

                <!-- Event Details Section (populated by templates) -->
                <div id="event-details-section" class="form-section form-section--collapsible hidden">
                    <div class="form-section__header">
                        <h3 class="form-section__title"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M14 2v6h6M16 13H8m8 4H8m2-8H8" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg> Event Details</h3>
                        <span class="form-section__optional">Template Fields</span>
                    </div>
                    <div id="event-details-container" class="event-details-fields"></div>
                </div>

                <!-- Advanced Options Section -->
                <div class="form-section form-section--collapsible">
                    <div class="form-section__header">
                        <h3 class="form-section__title">Advanced Options</h3>
                        <span class="form-section__optional">Optional</span>
                    </div>

                    <!-- Seating Chart Configuration -->
                    <div class="seating-config-section">
                        <div class="seating-config-toggle">
                            <label class="checkbox-label">
                                <input type="checkbox" id="enable-seating">
                                <span>Enable seating chart for this event</span>
                            </label>
                        </div>

                        <div id="seating-config-fields" class="hidden">
                            <div class="seating-config-fields">
                                <div class="seating-config-field">
                                    <label for="number-of-tables">Number of Tables</label>
                                    <input type="number" id="number-of-tables" min="1" max="100" value="10">
                                    <small>Total number of tables at the venue</small>
                                </div>

                                <div class="seating-config-field">
                                    <label for="seats-per-table">Seats per Table</label>
                                    <input type="number" id="seats-per-table" min="2" max="20" value="8">
                                    <small>Average capacity per table</small>
                                </div>
                            </div>

                            <div class="seating-config-info">
                                Total Capacity: <strong><span id="total-seating-capacity">80</span> seats</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Questions -->
                    <div class="form-group form-group--custom-questions">
                        <label>Custom Questions</label>
                        <p class="form-help">Add custom questions to gather specific information from attendees.</p>
                        <div id="custom-questions-container"></div>
                        <button type="button" class="btn btn-secondary" onclick="addCustomQuestion()"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14m-7-7h14" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg> Add Question</button>
                    </div>
                </div><!-- End Advanced Options Section -->

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="handleCancelEventCreation()" aria-label="Cancel and return to dashboard">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary" aria-label="Deploy event and create invitation">
                        <svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 00-2.91-.09zM12 15l-3-3a22 22 0 012-3.95A12.88 12.88 0 0122 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 01-4 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Deploy Event
                    </button>
                </div>
            </form>
        </div>

        <div id="manage" class="page">
            <div id="event-details"></div>
        </div>

        <div id="invite" class="page">
            <div id="invite-content"></div>
        </div>

        <!-- Admin Dashboard (Admin Only) -->
        <div id="admin" class="page">
            <div id="admin-dashboard-content">
                <!-- Admin dashboard content will be loaded here -->
            </div>
        </div>

        <div id="analytics" class="page">
            <h2>Analytics</h2>
            <p>Analytics content goes here.</p>
        </div>

            </div> <!-- closing detail-panel -->
        </main>
    </div>

    <div class="footer">
        <div class="footer-content">
            <div class="footer-logo">SEMPER ADMIN</div>
            
            <div class="footer-links">
                <a href="https://linktr.ee/semperadmin" target="_blank" class="footer-link">
                    <svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg> Official Linktree
                </a>
                <a href="mailto:contact@semperadmin.com" class="footer-link">
                    <svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" fill="none"/><path d="M22 6l-10 7L2 6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Contact Us
                </a>
                <a href="#" onclick="showPage('create')" class="footer-link">
                    <svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 00-2.91-.09zM12 15l-3-3a22 22 0 012-3.95A12.88 12.88 0 0122 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 01-4 2z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Create Event
                </a>
            </div>
            
            
            
            <div class="footer-copyright">
                Â© 2025 Semper Admin. All rights reserved. | EventCall - Professional Military Event Management
            </div>

        </div>
    </div>
</div>

<!-- Profile Dropdown - Updated for Manager Flow -->
<div id="profile-dropdown" class="profile-dropdown hidden">
  <!-- Header Section -->
  <div class="profile-dropdown__header">
    <div class="profile-dropdown__header-title"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" fill="none"/></svg> Event Manager</div>
    <div class="profile-dropdown__header-email" id="dropdown-email">User</div>
    <div class="profile-dropdown__header-subtitle">Personal Dashboard</div>
  </div>
  
  <!-- Status Section -->
  <div class="profile-dropdown__status">
    <div class="profile-dropdown__status-line">
      <span id="token-status-icon"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg></span>
      <span id="token-status-text" class="profile-dropdown__status-text">GitHub Connected</span>
    </div>
    <div class="profile-dropdown__status-note">
      Events synced to cloud â€¢ Secure token in memory
    </div>
  </div>
  
  <!-- Actions Section -->
  <div class="profile-dropdown__actions">
    <!-- Change Token Button -->
    <div class="profile-dropdown__action">
      <span class="profile-dropdown__icon"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 11-7.778 7.778 5.5 5.5 0 017.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4" stroke="currentColor" stroke-width="2" fill="none"/></svg></span> 
      <span>Change Token</span>
    </div>
    
    <!-- Logout Button -->
    <div class="profile-dropdown__action profile-dropdown__action--danger" id="logout-btn">
      <span class="profile-dropdown__icon"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg></span> 
      <span>Logout</span>
    </div>
  </div>
  
  <!-- Footer Section -->
  <div class="profile-dropdown__footer">
    <button id="cancel-dropdown" class="profile-dropdown__cancel">
      Cancel
    </button>
  </div>
</div>

<!-- User Profile Modal -->
<div id="user-profile-modal" class="modal-overlay" style="display: none;">
    <div class="modal" style="max-width: 500px;">
        <div class="modal-header">
            <h2>User Profile</h2>
        </div>
        <div class="modal-body">
            <div style="text-align: center; margin-bottom: 1rem;">
                <div style="width: 80px; height: 80px; border-radius: 50%; background: #5C4E4E; color: #D1D0D0; font-size: 2rem; font-weight: bold; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.5rem;">
                    <span id="profile-avatar"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2" fill="none"/><circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" fill="none"/></svg></span>
                </div>
            </div>

            <form id="profile-edit-form">
                <div class="form-group">
                    <label for="profile-username" class="form-label">Username</label>
                    <input
                        type="text"
                        id="profile-username"
                        class="form-control"
                        readonly
                        disabled
                        style="background: #f3f4f6; cursor: not-allowed; color: #6b7280;"
                    >
                    <div class="form-help">Username cannot be changed</div>
                </div>

                <div class="form-group">
                    <label for="profile-name" class="form-label">Full Name <span class="text-danger">*</span></label>
                    <input
                        type="text"
                        id="profile-name"
                        class="form-control"
                        required
                        minlength="2"
                        placeholder="Enter your full name"
                    >
                </div>

                <div class="form-group">
                    <label for="profile-email" class="form-label">Email Address <span class="text-danger">*</span></label>
                    <input
                        type="email"
                        id="profile-email"
                        class="form-control"
                        required
                        placeholder="your.email@example.com"
                        autocomplete="email"
                    >
                </div>

                <div class="form-group">
                    <label for="profile-branch" class="form-label">Service Branch</label>
                    <select id="profile-branch" class="form-control" onchange="window.updateProfileRanksForBranch && window.updateProfileRanksForBranch()">
                        <option value="">Select service branch...</option>
                        <option value="USA">United States Army</option>
                        <option value="USMC">United States Marine Corps</option>
                        <option value="USN">United States Navy</option>
                        <option value="USAF">United States Air Force</option>
                        <option value="USSF">United States Space Force</option>
                        <option value="USCG">United States Coast Guard</option>
                        <option value="Civilian">Civilian</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="profile-rank" class="form-label">Rank</label>
                    <select id="profile-rank" class="form-control">
                        <option value="">Select service branch first...</option>
                    </select>
                </div>
            </form>

            <!-- Password Change Section -->
            <div class="profile-password-section">
                <h4>Change Password</h4>
                <form id="profile-password-form">
                    <div class="form-group">
                        <label for="profile-current-password" class="form-label">Current Password</label>
                        <input
                            type="password"
                            id="profile-current-password"
                            class="form-control"
                            placeholder="Enter current password"
                            autocomplete="current-password"
                        >
                    </div>
                    <div class="form-group">
                        <label for="profile-new-password" class="form-label">New Password</label>
                        <input
                            type="password"
                            id="profile-new-password"
                            class="form-control"
                            placeholder="Enter new password (min 8 characters)"
                            minlength="8"
                            autocomplete="new-password"
                        >
                        <div id="profile-password-strength"></div>
                    </div>
                    <div class="form-group">
                        <label for="profile-confirm-password" class="form-label">Confirm New Password</label>
                        <input
                            type="password"
                            id="profile-confirm-password"
                            class="form-control"
                            placeholder="Confirm new password"
                            autocomplete="new-password"
                        >
                    </div>
                    <button type="submit" class="btn btn-primary btn-full-width">
                        Update Password
                    </button>
                </form>
            </div>
        </div>
        <div class="modal-footer" style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button type="button" class="btn btn-secondary" onclick="closeUserProfile()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveUserProfile()">Save Changes</button>
            <button type="button" class="btn btn-danger" onclick="logoutFromProfile()">Logout</button>
        </div>
    </div>
</div>

<!-- Edit RSVP Modal -->
<div id="edit-rsvp-modal" class="modal-overlay" style="display: none;">
    <div class="modal" style="max-width: 600px;">
        <div class="modal-header">
            <h2><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" stroke="currentColor" stroke-width="2" fill="none"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" fill="none"/></svg> Edit Your RSVP</h2>
        </div>
        <div class="modal-body">
            <div id="edit-rsvp-event-info" style="padding: 1rem; background: linear-gradient(135deg, rgba(92, 78, 78, 0.08), rgba(92, 78, 78, 0.03)); border-radius: 0.5rem; margin-bottom: 1.5rem;">
                <!-- Event info will be populated here -->
            </div>

            <form id="edit-rsvp-form">
                <div class="form-group">
                    <label for="edit-rsvp-name" class="form-label">Full Name <span class="text-danger">*</span></label>
                    <input
                        type="text"
                        id="edit-rsvp-name"
                        class="form-control"
                        required
                        minlength="2"
                        placeholder="Enter your full name"
                    >
                </div>

                <div class="form-group">
                    <label for="edit-rsvp-email" class="form-label">Email Address <span class="text-danger">*</span></label>
                    <input
                        type="email"
                        id="edit-rsvp-email"
                        class="form-control"
                        required
                        placeholder="your.email@example.com"
                    >
                </div>

                <div class="form-group">
                    <label for="edit-rsvp-phone" class="form-label">Phone Number</label>
                    <input
                        type="tel"
                        id="edit-rsvp-phone"
                        class="form-control"
                        placeholder="(555) 123-4567"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Will you be attending? <span class="text-danger">*</span></label>
                    <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="edit-attending" value="true" required style="margin-right: 0.5rem;">
                            <span><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Yes, I'll be there!</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" name="edit-attending" value="false" required style="margin-right: 0.5rem;">
                            <span><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Can't make it</span>
                        </label>
                    </div>
                </div>

                <div class="form-group" id="edit-guest-count-group" style="display: none;">
                    <label for="edit-guest-count" class="form-label">How many additional guests will you bring?</label>
                    <select id="edit-guest-count" class="form-control">
                        <option value="0">Just me</option>
                        <option value="1">+1 guest</option>
                        <option value="2">+2 guests</option>
                        <option value="3">+3 guests</option>
                        <option value="4">+4 guests</option>
                        <option value="5">+5 guests</option>
                    </select>
                </div>

                <div class="form-group" id="edit-reason-group" style="display: none;">
                    <label for="edit-reason" class="form-label">Why are you attending? (Optional)</label>
                    <textarea id="edit-reason" class="form-control" rows="3" placeholder="Share your thoughts..."></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer" style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button type="button" class="btn btn-secondary" onclick="closeEditRSVPModal()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveEditedRSVP()">Save Changes</button>
        </div>
    </div>
</div>

<!-- Cancel Event Creation Confirmation Modal -->
<div id="cancel-event-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="cancel-modal-title">
    <div class="modal modal--confirm">
        <div class="modal-header">
            <h3 id="cancel-modal-title"><svg class="ec-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg> Discard Changes?</h3>
        </div>
        <div class="modal-body">
            <p>You have unsaved changes. Are you sure you want to leave? Your draft will be saved and can be restored later.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeCancelModal()" autofocus>
                Keep Editing
            </button>
            <button type="button" class="btn btn-danger" onclick="confirmCancelEventCreation()">
                Discard & Leave
            </button>
        </div>
    </div>
</div>

<!-- PERFORMANCE OPTIMIZATION: Scripts reorganized, duplicates removed, defer added -->
<!-- PHASE 3: Lazy loading infrastructure -->
<script defer src="js/lazy-loader.js"></script>

<!-- Service Worker Registration -->
<script defer src="js/service-worker-registration.js"></script>

<!-- EARLY FUNCTIONS FIRST -->
<script defer src="js/error-handler.js"></script>
<script defer src="js/error-handler-enhanced.js"></script>
<script defer src="js/config.js?v=20251104-2"></script>
<script defer src="js/utils.js"></script>
<script defer src="js/rate-limiter.js"></script>
<script defer src="js/validation.js"></script>
<script defer src="js/loading.js"></script>
<script defer src="js/app-loader.js"></script>
<script defer src="js/csrf.js"></script>

<!-- Core modules -->
<script defer src="js/recurring-events.js"></script>
<script defer src="js/main.js?v=20260225"></script>
<script defer src="js/calendar-export.js"></script>
<script defer src="js/csv-import.js"></script>
<script defer src="js/event-templates.js?v=20260226b"></script>
<script defer src="js/military-data.js"></script>
<script defer src="js/qr-checkin.js"></script>
<script defer src="js/seating-chart.js"></script>

<!-- GitHub and Event Management -->
<script defer src="js/github-api.js"></script>
<script defer src="js/rsvp-handler.js"></script>
<script defer src="js/feedback-handler.js"></script>
<script defer src="js/ui-components.js"></script>
<script defer src="js/event-manager.js"></script>
<script defer src="js/manager-system.js"></script>
<script defer src="js/early-functions.js"></script>
<script defer src="js/user-rsvps.js"></script>

<!-- Admin Dashboard (Admin Only) -->
<script defer src="js/admin-dashboard.js"></script>
<script defer src="js/admin-debug.js"></script>
<script defer src="js/router.js"></script>
<script defer src="js/api-wrapper.js"></script>

<!-- External Libraries -->
<script defer src="https://cdn.jsdelivr.net/npm/validator@13.9.0/validator.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/libphonenumber-js@1.11.6/bundle/libphonenumber-js.min.js"></script>
<!-- PHASE 3: Chart.js (180KB) now lazy-loaded via LazyLoader (loads only for admin dashboard) -->
<!-- PHASE 3: zxcvbn (250KB) now lazy-loaded via LazyLoader (loads only when password field focused) -->

<!-- Backend API (must load before auth if backend is used) -->
<!-- Proxy configuration now handled in js/config.js -->
<script defer src="js/backend-api.js"></script>
<!-- Profile Completion Module - must load before user-auth.js -->
<script defer src="js/profile-completion.js?v=20260114"></script>
<!-- AUTHENTICATION - REPLACED manager-auth.js with user-auth.js -->
<script defer src="js/user-auth.js?v=20260225"></script>

<!-- UX-004: Form user experience enhancements -->
<script defer src="js/form-ux.js"></script>

<!-- GitHub and Event Management -->


</body>
</html>
 
